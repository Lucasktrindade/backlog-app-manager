<!DOCTYPE html>
<html lang="pt-br" data-theme="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Backlog — Multi Times (PWA)</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1220">
<script>if('serviceWorker'in navigator){addEventListener('load',()=>navigator.serviceWorker.register('./sw.js'));}</script>
<script src="https://unpkg.com/dexie@4/dist/dexie.min.js"></script>
<style>
:root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e5e7eb;--accent:#1d4ed8;--line:#1f2937;--link:#93c5fd;--card:#0e1930;--input:#0c172b}
[data-theme=light]{--bg:#f8fafc;--panel:#fff;--muted:#64748b;--text:#0f172a;--accent:#1d4ed8;--line:#e2e8f0;--link:#1d4ed8;--card:#fff;--input:#fff}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto}
header{position:sticky;top:0;background:rgba(0,0,0,.1);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);padding:10px 16px;display:flex;gap:12px;align-items:center;z-index:10}
h1{margin:0;font-size:18px;display:flex;gap:8px;align-items:center}.app-logo{width:24px;height:24px;border-radius:6px;border:1px solid var(--line);display:none}
.container{max-width:1200px;margin:0 auto;padding:16px}.panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px;margin-bottom:12px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
input,select,textarea,button{background:var(--input);color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px 10px;font-size:14px}
button.primary{background:var(--accent);border-color:var(--accent);color:#fff}button.link{background:transparent;border:none;color:var(--link);text-decoration:underline;cursor:pointer}
details>summary{list-style:none;cursor:pointer;padding:8px;border:1px solid var(--line);border-radius:10px;margin-bottom:8px;background:var(--panel)}
.kanban{display:grid;grid-template-columns:repeat(5,minmax(240px,1fr));gap:10px;overflow-x:auto}
.col{border:2px dashed var(--line);border-radius:10px;padding:10px;min-height:120px}.col.over{background:rgba(59,130,246,.08);border-color:#3b82f6}
.card{background:var(--card);border:1px solid var(--line);border-radius:10px;padding:10px;margin-bottom:8px}
.small{font-size:12px;color:var(--muted)}.tag{display:inline-block;padding:2px 8px;border:1px solid var(--line);border-radius:999px;margin:2px 4px 0 0;font-size:12px}
ul.comments{list-style:disc;padding-left:18px;margin:6px 0 0 0}.comments li{font-size:12px;color:var(--muted)}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:50;padding:16px}
.modal{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:16px;width:min(760px,96vw)}
.toast{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);background:var(--panel);border:1px solid var(--line);border-radius:999px;padding:8px 12px;display:none}
@media(max-width:640px){.kanban{grid-template-columns:repeat(5,minmax(220px,1fr));}}
</style>
</head>
<body>
<header>
  <h1><img id="appLogo" class="app-logo"><span id="appTitle">Backlog — Multi Times</span></h1>
  <input id="q" placeholder="Pesquisar (título, tags, pessoa, link)">
  <select id="fltTeam"></select>
  <select id="fltStatus"><option value="">Todos status</option><option value="despriorizado">Despriorizado</option><option value="a_fazer">A fazer</option><option value="fazendo">Em andamento</option><option value="bloqueado">Bloqueado</option><option value="feito">Feito</option></select>
  <button id="btnExport">Exportar JSON</button>
  <button id="btnImport" class="link">Importar</button><input type="file" id="importFile" accept="application/json" style="display:none">
  <button id="btnBindFile" class="link">Vincular arquivo (Auto‑save)</button>
  <span id="autoSaveState" class="small">Auto‑save: desligado</span>
  <label style="margin-left:auto"><input id="themeToggle" type="checkbox"> Tema claro</label>
</header>
<div class="container">
  <details class="panel" id="secTeams"><summary><strong>Times & Pessoas</strong> — clique para expandir</summary>
    <div class="row"><input id="teamName" placeholder="Nome do time"><button id="btnAddTeam" class="primary">+ Time</button></div>
    <div id="teams" style="margin:8px 0"></div>
    <div class="row"><select id="personTeam"></select><input id="personName" placeholder="Nome da pessoa"><input id="personEmail" placeholder="Email"><button id="btnAddPerson" class="primary">+ Pessoa</button></div>
    <div id="people"></div>
  </details>
  <details class="panel" id="secNew"><summary><strong>Cadastro de Iniciativas</strong> — clique para expandir</summary>
    <div class="row"><select id="initTeam"></select><input id="initTitle" placeholder="Título"><select id="initAssignee"></select><input type="date" id="initDue"></div>
    <div class="row"><select id="initStatus"><option value="despriorizado">Despriorizado</option><option value="a_fazer">A fazer</option><option value="fazendo">Em andamento</option><option value="bloqueado">Bloqueado</option><option value="feito">Feito</option></select>
    <select id="initPriority"><option>Média</option><option>Alta</option><option>Baixa</option></select><input id="initEffort" placeholder="Esforço (pts/dias)"></div>
    <textarea id="initDesc" rows="2" placeholder="Descrição"></textarea>
    <div class="row"><input id="initTags" class="grow" placeholder="Tags, separadas por vírgula"></div>
    <div class="row"><select id="linkPlatform"><option>Azure DevOps</option><option>Jira</option><option>HubSpot</option><option>Outro</option></select><input id="linkUrl" class="grow" placeholder="URL"><button id="btnAddTempLink">+ Link</button></div>
    <div id="tempLinks"></div>
    <div class="row"><input id="initComment" class="grow" placeholder="Comentário inicial (opcional)"><button id="btnAddInitiative" class="primary">+ Adicionar Iniciativa</button></div>
  </details>
  <div class="panel"><h2>Backlog (Kanban)</h2>
    <div class="kanban">
      <div class="col" data-status="despriorizado"><h3>Despriorizado <span id="count_desp"></span></h3><div id="col_desp" class="dropzone"></div></div>
      <div class="col" data-status="a_fazer"><h3>A fazer <span id="count_todo"></span></h3><div id="col_todo" class="dropzone"></div></div>
      <div class="col" data-status="fazendo"><h3>Em andamento <span id="count_doing"></span></h3><div id="col_doing" class="dropzone"></div></div>
      <div class="col" data-status="bloqueado"><h3>Bloqueado <span id="count_block"></span></h3><div id="col_block" class="dropzone"></div></div>
      <div class="col" data-status="feito"><h3>Feito <span id="count_done"></span></h3><div id="col_done" class="dropzone"></div></div>
    </div>
  </div>
  <div class="panel"><h2>Backlog (Lista)</h2><table id="listTable" style="width:100%"></table></div>
</div>
<div id="toast" class="toast"></div>

<div id="modalBackdrop" class="modal-backdrop"><div class="modal">
  <header class="row" style="justify-content:space-between"><h3>Editar Iniciativa</h3><button id="btnCloseModal" class="link">Fechar</button></header>
  <input type="hidden" id="editId">
  <div class="row"><select id="editTeam"></select><input id="editTitle" placeholder="Título"></div>
  <textarea id="editDesc" rows="3" placeholder="Descrição"></textarea>
  <div class="row"><select id="editAssignee"></select><input type="date" id="editDue"><select id="editStatus"><option value="despriorizado">Despriorizado</option><option value="a_fazer">A fazer</option><option value="fazendo">Em andamento</option><option value="bloqueado">Bloqueado</option><option value="feito">Feito</option></select><select id="editPriority"><option>Média</option><option>Alta</option><option>Baixa</option></select><input id="editEffort" placeholder="Esforço"></div>
  <div class="row"><input id="editTags" class="grow" placeholder="Tags (vírgula)"></div>
  <div class="row"><select id="editLinkPlatform"><option>Azure DevOps</option><option>Jira</option><option>HubSpot</option><option>Outro</option></select><input id="editLinkUrl" placeholder="URL"><button id="btnEditAddLink">+ Link</button></div>
  <div id="editLinks"></div>
  <hr style="border-color:var(--line)">
  <h4>Comentários</h4>
  <ul id="editComments" class="comments"></ul>
  <div class="row"><input id="editNewComment" class="grow" placeholder="Adicionar comentário"><button id="btnAddComment">Adicionar</button></div>
  <footer class="row" style="justify-content:flex-end"><button id="btnCancelModal">Cancelar</button><button id="btnSaveEdit" class="primary">Salvar alterações</button></footer>
</div></div>

<script>
const DB="backlog_pwa_store_v2"; let dbx;
let autoSaveHandle=null, autoSaveEnabled=false, autoSaveName="";
const db={teams:[],people:[],initiatives:[]};
const THEME="backlog_theme";

async function initDB(){ dbx=new Dexie(DB); dbx.version(1).stores({meta:'key',data:'id'}); await dbx.open(); }
async function load(){ const s=await dbx.data.get('snapshot'); return s&&s.value? s.value:{teams:[],people:[],initiatives:[]}; }
async function save(){
  await dbx.data.put({id:'snapshot',value:db});
  if (autoSaveEnabled && autoSaveHandle) {
    try{
      const w = await autoSaveHandle.createWritable();
      await w.write(new Blob([JSON.stringify(db,null,2)],{type:'application/json'}));
      await w.close();
      setAutoSaveState(true);
    }catch(e){
      setAutoSaveState(false, 'Erro ao salvar');
    }
  }
}
function setAutoSaveState(on, msg){
  const el=document.getElementById('autoSaveState'); if(!el) return;
  if(on){ el.textContent = `Auto‑save: ligado${autoSaveName?` (${autoSaveName})`:''}`; }
  else { el.textContent = `Auto‑save: desligado${msg?` — ${msg}`:''}`; }
}
async function bindAutoSave(){
  if(!('showSaveFilePicker' in window)){ alert('Auto‑save requer Chrome/Edge (File System Access API).'); return; }
  try{
    autoSaveHandle = await window.showSaveFilePicker({
      suggestedName: 'backlog_multitimes.json',
      types:[{description:'JSON', accept:{'application/json':['.json']}}]
    });
    autoSaveEnabled = true;
    autoSaveName = autoSaveHandle.name || '';
    setAutoSaveState(true);
    await save();
  }catch(e){
    setAutoSaveState(false,'cancelado');
  }
}

function uid(){ return Math.random().toString(36).slice(2,9)+Date.now().toString(36).slice(-4); }
function teamName(id){ return (db.teams.find(t=>t.id===id)||{}).name||'—'; }
function personName(id){ return (db.people.find(p=>p.id===id)||{}).name||'—'; }
function setText(id,txt){ const el=document.getElementById(id); if(el) el.textContent=txt; }
function toast(m){ const el=document.getElementById('toast'); if(!el) return; el.textContent=m; el.style.display='block'; setTimeout(()=>el.style.display='none',1600); }

function renderTeams(){
  const el=document.getElementById('teams'); if(!el) return;
  el.innerHTML=db.teams.map(t=>`<div class="row" style="justify-content:space-between;border-bottom:1px dashed var(--line);padding:6px 0;"><strong>${t.name}</strong><span><button class="link" onclick="renameTeam('${t.id}')">Renomear</button> <button class="link" onclick="removeTeam('${t.id}')">Excluir</button></span></div>`).join('')||'<div class="small">Adicione seus times.</div>';
  const sel=(id)=>{const s=document.getElementById(id); if(!s) return; s.innerHTML='<option value="">— Time —</option>'+db.teams.map(t=>`<option value="${t.id}">${t.name}</option>`).join('');};
  sel('personTeam'); sel('initTeam'); sel('editTeam');
  const flt=document.getElementById('fltTeam'); if(flt) flt.innerHTML='<option value="">Todos os times</option>'+db.teams.map(t=>`<option value="${t.id}">${t.name}</option>`).join('');
}
function renderPeople(){
  const el=document.getElementById('people'); if(!el) return;
  el.innerHTML=db.people.map(p=>`<div class="row" style="justify-content:space-between;border-bottom:1px dashed var(--line);padding:6px 0;"><span><strong>${p.name}</strong> <span class="small">(${teamName(p.teamId)})</span></span><span><button class="link" onclick="renamePerson('${p.id}')">Renomear</button> <button class="link" onclick="removePerson('${p.id}')">Excluir</button></span></div>`).join('')||'';
  const a=document.getElementById('initAssignee'); if(a) a.innerHTML='<option value="">— Responsável —</option>'+db.people.map(p=>`<option value="${p.id}">${p.name}</option>`).join('');
  const e=document.getElementById('editAssignee'); if(e) e.innerHTML=a.innerHTML;
}
function card(i){
  const due=i.due? new Date(i.due).toLocaleDateString():'—';
  const comments = (i.comments||[]).slice(-2).map(c=>`<li>${c.text} <span class="small">(${c.at})</span></li>`).join('');
  return `<div class="card" draggable="true" data-id="${i.id}">
    <strong>${i.title}</strong>
    <div class="small">${teamName(i.teamId)} • ${personName(i.assigneeId)} • ${due} • ${i.priority||'Média'}</div>
    <div class="small">${i.desc||''}</div>
    ${(i.comments&&i.comments.length)?`<ul class="comments">${comments}</ul>`:''}
    <div class="row"><button class="link" onclick="openEdit('${i.id}')">Editar</button><button class="link" onclick="moveInit('${i.id}','despriorizado')">Despriorizar</button><button class="link" onclick="moveInit('${i.id}','a_fazer')">A fazer</button><button class="link" onclick="moveInit('${i.id}','fazendo')">Em andamento</button><button class="link" onclick="moveInit('${i.id}','bloqueado')">Bloqueado</button><button class="link" onclick="moveInit('${i.id}','feito')">Feito</button><button class="link" onclick="removeInit('${i.id}')">Excluir</button></div>
  </div>`;
}
function renderKanban(){
  const list=filter(db.initiatives);
  const cols={despriorizado:'col_desp',a_fazer:'col_todo',fazendo:'col_doing',bloqueado:'col_block',feito:'col_done'};
  const counts={despriorizado:0,a_fazer:0,fazendo:0,bloqueado:0,feito:0};
  Object.keys(cols).forEach(k=>{ const el=document.getElementById(cols[k]); if(el) el.innerHTML=''; });
  list.forEach(i=>{ const el=document.getElementById(cols[i.status]||'col_todo'); if(!el) return; el.insertAdjacentHTML('beforeend', card(i)); counts[i.status]=(counts[i.status]||0)+1; });
  setText('count_desp',`(${counts.despriorizado||0})`);
  setText('count_todo',`(${counts.a_fazer||0})`);
  setText('count_doing',`(${counts.fazendo||0})`);
  setText('count_block',`(${counts.bloqueado||0})`);
  setText('count_done',`(${counts.feito||0})`);
  enableDnD();
}
function renderTable(){
  const list=filter(db.initiatives); const el=document.getElementById('listTable'); if(!el) return;
  if(!list.length){ el.innerHTML='<tr><td class="small">Sem iniciativas.</td></tr>'; return; }
  el.innerHTML='<tr><th>Título</th><th>Time</th><th>Resp.</th><th>Status</th><th>Prioridade</th><th>Venc.</th><th>Comentários</th><th></th></tr>'+
    list.map(i=>`<tr><td><strong>${i.title}</strong></td><td>${teamName(i.teamId)}</td><td>${personName(i.assigneeId)}</td><td>${i.status}</td><td>${i.priority||'Média'}</td><td>${i.due||'—'}</td><td>${(i.comments||[]).length}</td><td><button class="link" onclick="openEdit('${i.id}')">Editar</button></td></tr>`).join('');
}
async function addTeam(){ const n=document.getElementById('teamName').value.trim(); if(!n) return; db.teams.push({id:uid(),name:n}); await save(); document.getElementById('teamName').value=''; renderTeams(); renderPeople(); renderKanban(); renderTable(); }
function renameTeam(id){ const t=db.teams.find(x=>x.id===id); if(!t) return; const n=prompt('Novo nome do time:', t.name); if(!n) return; t.name=n.trim(); save(); renderTeams(); renderKanban(); renderTable(); }
function removeTeam(id){ if(!confirm('Excluir time e suas iniciativas/pessoas?')) return; db.teams=db.teams.filter(t=>t.id!==id); db.people=db.people.filter(p=>p.teamId!==id); db.initiatives=db.initiatives.filter(i=>i.teamId!==id); save(); renderTeams(); renderPeople(); renderKanban(); renderTable(); }
async function addPerson(){ const team=document.getElementById('personTeam').value; const name=document.getElementById('personName').value.trim(); const email=document.getElementById('personEmail').value.trim(); if(!team||!name) return; db.people.push({id:uid(),name,email,teamId:team}); await save(); document.getElementById('personName').value=''; document.getElementById('personEmail').value=''; renderPeople(); renderKanban(); renderTable(); }

function addTempLink(){ const p=document.getElementById('linkPlatform').value; const u=document.getElementById('linkUrl').value.trim(); if(!u) return; (window._tempLinks ||= []).push({platform:p,url:u}); document.getElementById('linkUrl').value=''; document.getElementById('tempLinks').innerHTML=window._tempLinks.map((l)=>`<span class="tag">${l.platform}: <a href="${l.url}" target="_blank">link</a></span>`).join(''); }

async function addInitiative(){
  const team=document.getElementById('initTeam').value; const title=document.getElementById('initTitle').value.trim(); if(!team||!title) return;
  const desc=document.getElementById('initDesc').value.trim(); const assignee=document.getElementById('initAssignee').value; const due=document.getElementById('initDue').value;
  const status=document.getElementById('initStatus').value; const priority=document.getElementById('initPriority').value||'Média'; const effort=document.getElementById('initEffort').value.trim(); const tags=(document.getElementById('initTags').value||'').split(',').map(x=>x.trim()).filter(Boolean);
  const commentText=(document.getElementById('initComment').value||'').trim();
  const comments = commentText ? [{ text: commentText, at: new Date().toLocaleString() }] : [];
  const links = (window._tempLinks||[]); window._tempLinks = []; document.getElementById('tempLinks').innerHTML='';
  db.initiatives.push({id:uid(),teamId:team,title,desc,assigneeId:assignee,due,status,priority,effort,tags,links,comments});
  await save();
  ['initTitle','initDesc','initTags','initEffort','initComment'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
  renderKanban(); renderTable();
}

function openEdit(id){
  const i=db.initiatives.find(x=>x.id===id); if(!i) return;
  setVal('editId',i.id); setVal('editTitle',i.title||''); setVal('editDesc',i.desc||''); setSel('editTeam',i.teamId||''); setSel('editAssignee',i.assigneeId||''); setVal('editDue',i.due||''); setSel('editStatus',i.status||'a_fazer'); setSel('editPriority',i.priority||'Média'); setVal('editEffort',i.effort||''); setVal('editTags',(i.tags||[]).join(', '));
  const el=document.getElementById('editLinks'); el.dataset.links=JSON.stringify(i.links||[]); el.innerHTML=(i.links||[]).map((l)=>`<span class='tag'>${l.platform}: <a href='${l.url}' target='_blank'>link</a></span>`).join('')||'<span class="small">Sem links</span>';
  renderComments(i);
  showModal(true);
}
function renderComments(i){
  const ul=document.getElementById('editComments'); if(!ul) return;
  ul.innerHTML=(i.comments||[]).map(c=>`<li>${c.text} <span class="small">(${c.at})</span></li>`).join('')||'<li class="small">Sem comentários ainda.</li>';
}
function setVal(id,v){ const el=document.getElementById(id); if(el) el.value=v; } function setSel(id,v){ const el=document.getElementById(id); if(el) el.value=v; }
function showModal(b){ document.getElementById('modalBackdrop').style.display=b?'flex':'none'; }
async function saveEdit(){
  const id=document.getElementById('editId').value; const i=db.initiatives.find(x=>x.id===id); if(!i) return;
  i.title=document.getElementById('editTitle').value.trim(); i.desc=document.getElementById('editDesc').value.trim(); i.teamId=document.getElementById('editTeam').value; i.assigneeId=document.getElementById('editAssignee').value; i.due=document.getElementById('editDue').value; i.status=document.getElementById('editStatus').value; i.priority=document.getElementById('editPriority').value||'Média'; i.effort=document.getElementById('editEffort').value.trim(); i.tags=(document.getElementById('editTags').value||'').split(',').map(x=>x.trim()).filter(Boolean);
  const linksEl=document.getElementById('editLinks'); try{ i.links = JSON.parse(linksEl.dataset.links||'[]'); }catch(e){}
  await save(); showModal(false); renderKanban(); renderTable();
}

document.getElementById('btnAddComment').onclick = async () => {
  const id=document.getElementById('editId').value; const text=(document.getElementById('editNewComment').value||'').trim(); if(!id||!text) return;
  const it=db.initiatives.find(x=>x.id===id); if(!it) return;
  (it.comments ||= []).push({ text, at: new Date().toLocaleString() });
  document.getElementById('editNewComment').value='';
  await save(); renderComments(it); renderKanban(); renderTable();
};

function enableDnD(){ document.querySelectorAll('.card').forEach(c=>{ c.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', c.dataset.id); }); }); document.querySelectorAll('.col').forEach(col=>{ col.addEventListener('dragover',e=>e.preventDefault()); col.addEventListener('drop',async e=>{ e.preventDefault(); const id=e.dataTransfer.getData('text/plain'); const it=db.initiatives.find(x=>x.id===id); if(it){ it.status=col.dataset.status; await save(); renderKanban(); renderTable(); } }); }); }
function moveInit(id, st){ const it=db.initiatives.find(x=>x.id===id); if(!it) return; it.status=st; save(); renderKanban(); renderTable(); }
function removeInit(id){ if(!confirm('Excluir iniciativa?')) return; db.initiatives=db.initiatives.filter(x=>x.id!==id); save(); renderKanban(); renderTable(); }
function filter(list){ const q=(document.getElementById('q').value||'').toLowerCase(); const t=document.getElementById('fltTeam').value; const s=document.getElementById('fltStatus').value; return list.filter(i=>{ if(t && i.teamId!==t) return false; if(s && i.status!==s) return false; if(q){ const hay=[i.title,i.desc,personName(i.assigneeId),teamName(i.teamId),(i.tags||[]).join(' '),...(i.links||[]).map(l=>l.platform+' '+l.url),...(i.comments||[]).map(c=>c.text)].join(' ').toLowerCase(); if(!hay.includes(q)) return false; } return true; }); }

function loadTheme(){ const t=localStorage.getItem(THEME)||'dark'; document.documentElement.setAttribute('data-theme',t); document.getElementById('themeToggle').checked=(t==='light'); }
function toggleTheme(){ const cur=document.documentElement.getAttribute('data-theme'); const nxt=cur==='dark'?'light':'dark'; document.documentElement.setAttribute('data-theme',nxt); localStorage.setItem(THEME,nxt); }
document.getElementById('themeToggle').onchange=toggleTheme;

document.getElementById('btnExport').onclick=()=>{ const blob=new Blob([JSON.stringify(db,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='backlog.json'; a.click(); };
document.getElementById('btnImport').onclick=()=>document.getElementById('importFile').click();
document.getElementById('importFile').onchange=(e)=>{ const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=ev=>{ try{ const data=JSON.parse(ev.target.result); ['teams','people','initiatives'].forEach(k=>db[k]=data[k]||[]); save(); renderTeams(); renderPeople(); renderKanban(); renderTable(); }catch(err){ alert('JSON inválido'); } }; r.readAsText(f); };

document.getElementById('btnAddTeam').onclick=addTeam;
document.getElementById('btnAddPerson').onclick=addPerson;
document.getElementById('btnAddTempLink').onclick=addTempLink;
document.getElementById('btnAddInitiative').onclick=addInitiative;
document.getElementById('btnSaveEdit').onclick=saveEdit;
document.getElementById('btnCancelModal').onclick=()=>showModal(false);
document.getElementById('btnCloseModal').onclick=()=>showModal(false);
document.getElementById('q').oninput=()=>{renderKanban(); renderTable();};
document.getElementById('fltTeam').onchange=()=>{renderKanban(); renderTable();};
document.getElementById('fltStatus').onchange=()=>{renderKanban(); renderTable();};
document.getElementById('btnBindFile').onclick=bindAutoSave;

addEventListener('DOMContentLoaded', async()=>{
  await initDB();
  loadTheme();
  const data=await load();
  ['teams','people','initiatives'].forEach(k=>db[k]=data[k]||[]);
  renderTeams(); renderPeople(); renderKanban(); renderTable();
  setAutoSaveState(false);
});
</script>
</body>
</html>
